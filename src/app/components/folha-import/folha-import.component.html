<div class="excel-import-container">
  <div class="import-card">
    <h2 class="import-title">Importar Dados do Excel - Folha</h2>
    <p class="import-description">
      Selecione um arquivo Excel (.xlsx, .xls ou .csv) com dados de folha de pagamento
    </p>

    <!-- Área de seleção de arquivo -->
    <div class="file-input-wrapper">
      <input 
        type="file" 
        id="fileInput" 
        class="file-input"
        accept=".xlsx,.xls,.csv"
        (change)="onFileSelected($event)"
        [disabled]="isLoading"
      />
      <label for="fileInput" class="file-label">
        <svg class="upload-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="17 8 12 3 7 8"></polyline>
          <line x1="12" y1="3" x2="12" y2="15"></line>
        </svg>
        <span>{{ fileName || 'Escolher arquivo' }}</span>
      </label>
    </div>

    <!-- Mensagem de status -->
    <div *ngIf="statusMessage" class="status-message" [ngClass]="getStatusClass()">
      <div class="status-icon">
        <svg *ngIf="importStatus === 'processing'" class="spinner" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="12" y1="2" x2="12" y2="6"></line>
          <line x1="12" y1="18" x2="12" y2="22"></line>
          <line x1="4.93" y1="4.93" x2="7.76" y2="7.76"></line>
          <line x1="16.24" y1="16.24" x2="19.07" y2="19.07"></line>
          <line x1="2" y1="12" x2="6" y2="12"></line>
          <line x1="18" y1="12" x2="22" y2="12"></line>
          <line x1="4.93" y1="19.07" x2="7.76" y2="16.24"></line>
          <line x1="16.24" y1="7.76" x2="19.07" y2="4.93"></line>
        </svg>
        <svg *ngIf="importStatus === 'success'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        <svg *ngIf="importStatus === 'error'" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="15" y1="9" x2="9" y2="15"></line>
          <line x1="9" y1="9" x2="15" y2="15"></line>
        </svg>
      </div>
      <span>{{ statusMessage }}</span>
    </div>

    <!-- Barra de Progresso -->
    <div *ngIf="importStatus === 'processing' && totalToImport > 0" class="progress-container">
      <div class="progress-header">
        <span class="progress-label">Progresso da Importação</span>
        <span class="progress-percentage">{{ importProgress }}%</span>
      </div>
      <div class="progress-bar-wrapper">
        <div class="progress-bar" [style.width.%]="importProgress"></div>
      </div>
      <div class="progress-details">
        <span>{{ importedCount }} de {{ totalToImport }} registros importados</span>
      </div>
    </div>

    <!-- Prévia dos dados -->
    <div *ngIf="previewData.length > 0" class="preview-section">
      <h3 class="preview-title">Prévia dos Dados (primeiras 5 linhas)</h3>
      <div class="table-wrapper">
        <table class="preview-table">
          <thead>
            <tr>
              <th *ngFor="let column of columnNames">{{ column }}</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let row of previewData">
              <td *ngFor="let column of columnNames">{{ formatPreviewValue(row[column], column) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <p class="total-rows">Total de linhas no arquivo: <strong>{{ totalRows }}</strong></p>
    </div>

    <!-- Botão de importação -->
    <div class="action-buttons">
      <button 
        *ngIf="selectedFile && importStatus !== 'processing'"
        class="btn btn-primary"
        (click)="importToFirestore()"
        [disabled]="isLoading || !selectedFile"
      >
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 2v6h-6"></path>
          <path d="M3 12a9 9 0 0 1 15-6.7L21 8"></path>
          <path d="M3 22v-6h6"></path>
          <path d="M21 12a9 9 0 0 1-15 6.7L3 16"></path>
        </svg>
        Importar para Firestore
      </button>

      <button 
        *ngIf="selectedFile"
        class="btn btn-secondary"
        (click)="resetImport()"
        [disabled]="isLoading"
      >
        Cancelar
      </button>
    </div>

    <!-- Informações adicionais -->
    <div class="info-section">
      <h4>Colunas Esperadas</h4>
      <ul>
        <li><strong>Identificação:</strong> FUNCIONARIO, CENTRO CUSTO, DESCRICAO CC, MES, ANO</li>
        <li><strong>Remuneração:</strong> SALARIO, SALARIO MES, SALARIO LIQUIDO</li>
        <li><strong>Adicionais:</strong> ADIANTAMENTO, COMISSAO+DSR, HORAS EXTRAS, BONUS, INSALUBRIDADE, FERIAS</li>
        <li><strong>Benefícios:</strong> ODONTO, VALE CULTURA, FARMACIA</li>
        <li><strong>Descontos:</strong> INSS, INSS13º, INSS FERIAS, SISTEMA S, RAT, FGTS, IRRF, IRRF FERIAS</li>
      </ul>
    </div>
  </div>
</div>
